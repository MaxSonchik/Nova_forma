-- Extended Sample Data Script v2
-- Creates 100+ records in operational tables for realistic testing
-- Run after schema_migration_v5.sql
BEGIN;
-- ============================================================================
-- 1. CLEAR EXISTING DATA
-- ============================================================================
TRUNCATE TABLE логи_операций CASCADE;
TRUNCATE TABLE план_заготовок CASCADE;
TRUNCATE TABLE состав_закупки CASCADE;
TRUNCATE TABLE закупки_материалов CASCADE;
TRUNCATE TABLE график_работы CASCADE;
TRUNCATE TABLE состав_изделия CASCADE;
TRUNCATE TABLE расход_материалов CASCADE;
TRUNCATE TABLE состав_заказа CASCADE;
TRUNCATE TABLE заказы CASCADE;
TRUNCATE TABLE изделия CASCADE;
TRUNCATE TABLE заготовки CASCADE;
TRUNCATE TABLE материалы CASCADE;
TRUNCATE TABLE клиенты CASCADE;
TRUNCATE TABLE сотрудники CASCADE;
-- ============================================================================
-- 2. СОТРУДНИКИ (Employees) - 10 records
-- ============================================================================
INSERT INTO сотрудники (
        фио,
        номер_телефона,
        дата_рождения,
        должность,
        зарплата,
        дата_найма,
        login,
        password_hash
    )
VALUES (
        'Директор Иван',
        '+79001000001',
        '1980-05-15',
        'директор',
        150000.00,
        '2020-01-01',
        'director',
        '$2b$12$abc123'
    ),
    (
        'Менеджер Мария',
        '+79001000002',
        '1985-08-22',
        'менеджер',
        80000.00,
        '2021-03-15',
        'manager1',
        '$2b$12$abc123'
    ),
    (
        'Менеджер Алексей',
        '+79001000003',
        '1988-11-10',
        'менеджер',
        75000.00,
        '2021-06-01',
        'manager2',
        '$2b$12$abc123'
    ),
    (
        'Сборщик Петр',
        '+79001000004',
        '1990-02-28',
        'сборщик',
        55000.00,
        '2022-01-10',
        'worker1',
        '$2b$12$abc123'
    ),
    (
        'Сборщик Николай',
        '+79001000005',
        '1992-07-14',
        'сборщик',
        52000.00,
        '2022-03-20',
        'worker2',
        '$2b$12$abc123'
    ),
    (
        'Сборщик Анна',
        '+79001000006',
        '1995-04-05',
        'сборщик',
        50000.00,
        '2022-06-15',
        'worker3',
        '$2b$12$abc123'
    ),
    (
        'Сборщик Дмитрий',
        '+79001000007',
        '1993-09-18',
        'сборщик',
        53000.00,
        '2022-08-01',
        'worker4',
        '$2b$12$abc123'
    ),
    (
        'Сборщик Елена',
        '+79001000008',
        '1991-12-25',
        'сборщик',
        51000.00,
        '2023-01-10',
        'worker5',
        '$2b$12$abc123'
    ),
    (
        'Менеджер Ольга',
        '+79001000009',
        '1987-03-30',
        'менеджер',
        77000.00,
        '2023-04-01',
        'manager3',
        '$2b$12$abc123'
    ),
    (
        'Сборщик Михаил',
        '+79001000010',
        '1994-06-12',
        'сборщик',
        48000.00,
        '2023-09-01',
        'worker6',
        '$2b$12$abc123'
    );
-- ============================================================================
-- 3. КЛИЕНТЫ (Clients) - 30 records
-- ============================================================================
INSERT INTO клиенты (фио, инн, номер_телефона, адрес)
VALUES (
        'Иванов Петр Сергеевич',
        '123456789012',
        '+79101234567',
        'г. Москва, ул. Ленина, д. 10'
    ),
    (
        'Сидорова Анна Владимировна',
        '234567890123',
        '+79102345678',
        'г. Москва, ул. Пушкина, д. 5'
    ),
    (
        'Козлов Андрей Игоревич',
        '345678901234',
        '+79103456789',
        'г. Санкт-Петербург, Невский пр., д. 100'
    ),
    (
        'Морозова Елена Александровна',
        '456789012345',
        '+79104567890',
        'г. Казань, ул. Баумана, д. 25'
    ),
    (
        'Волков Дмитрий Павлович',
        '567890123456',
        '+79105678901',
        'г. Нижний Новгород, ул. Минина, д. 7'
    ),
    (
        'Соколова Ирина Николаевна',
        '678901234567',
        '+79106789012',
        'г. Екатеринбург, ул. Малышева, д. 56'
    ),
    (
        'Лебедев Алексей Васильевич',
        '789012345678',
        '+79107890123',
        'г. Новосибирск, Красный проспект, д. 50'
    ),
    (
        'Федорова Мария Петровна',
        '890123456789',
        '+79108901234',
        'г. Краснодар, ул. Красная, д. 135'
    ),
    (
        'Михайлов Сергей Олегович',
        '901234567890',
        '+79109012345',
        'г. Ростов-на-Дону, ул. Большая Садовая, д. 80'
    ),
    (
        'Новикова Татьяна Ивановна',
        '012345678901',
        '+79100123456',
        'г. Самара, ул. Куйбышева, д. 45'
    ),
    (
        'Кузнецов Владимир Андреевич',
        '111222333444',
        '+79111111111',
        'г. Воронеж, ул. Кирова, д. 10'
    ),
    (
        'Попова Светлана Михайловна',
        '222333444555',
        '+79112222222',
        'г. Омск, ул. Ленина, д. 20'
    ),
    (
        'Васильев Игорь Дмитриевич',
        '333444555666',
        '+79113333333',
        'г. Челябинск, ул. Цвиллинга, д. 30'
    ),
    (
        'Зайцева Ольга Александровна',
        '444555666777',
        '+79114444444',
        'г. Уфа, ул. Ленина, д. 40'
    ),
    (
        'Павлов Артем Сергеевич',
        '555666777888',
        '+79115555555',
        'г. Пермь, ул. Комсомольская, д. 50'
    ),
    (
        'Семенова Наталья Викторовна',
        '666777888999',
        '+79116666666',
        'г. Волгоград, ул. Мира, д. 60'
    ),
    (
        'Голубев Максим Юрьевич',
        '777888999000',
        '+79117777777',
        'г. Саратов, ул. Московская, д. 70'
    ),
    (
        'Виноградова Юлия Олеговна',
        '888999000111',
        '+79118888888',
        'г. Тюмень, ул. Республики, д. 80'
    ),
    (
        'Богданов Денис Александрович',
        '999000111222',
        '+79119999999',
        'г. Тула, ул. Советская, д. 90'
    ),
    (
        'Воробьева Екатерина Павловна',
        '000111222333',
        '+79110000000',
        'г. Рязань, ул. Почтовая, д. 100'
    ),
    (
        'ООО "Мебельный Рай"',
        '1234567890',
        '+74951234567',
        'г. Москва, ул. Промышленная, д. 5'
    ),
    (
        'ИП Столяров А.В.',
        '123456789012',
        '+74952345678',
        'г. Москва, ул. Деловая, д. 12'
    ),
    (
        'ООО "Офис Комфорт"',
        '2345678901',
        '+74953456789',
        'г. Москва, ул. Офисная, д. 8'
    ),
    (
        'ООО "Гостиница Центральная"',
        '3456789012',
        '+74954567890',
        'г. Москва, ул. Гостиничная, д. 1'
    ),
    (
        'ИП Мебельщиков Б.Б.',
        '456789012345',
        '+74955678901',
        'г. Подольск, ул. Мастеров, д. 15'
    ),
    (
        'ООО "Школа №5"',
        '4567890123',
        '+74956789012',
        'г. Москва, ул. Школьная, д. 5'
    ),
    (
        'ООО "Клиника Здоровье"',
        '5678901234',
        '+74957890123',
        'г. Москва, ул. Медицинская, д. 3'
    ),
    (
        'ИП Дизайнерова К.К.',
        '678901234567',
        '+74958901234',
        'г. Москва, ул. Творческая, д. 22'
    ),
    (
        'ООО "Ресторан Вкусно"',
        '6789012345',
        '+74959012345',
        'г. Москва, ул. Ресторанная, д. 7'
    ),
    (
        'ООО "Банк Надежный"',
        '7890123456',
        '+74950123456',
        'г. Москва, ул. Финансовая, д. 1'
    );
-- ============================================================================
-- 4. МАТЕРИАЛЫ (Materials) - 25 records
-- ============================================================================
INSERT INTO материалы (
        артикул_материала,
        наименование,
        количество_на_складе,
        единица_измерения,
        минимальный_остаток,
        цена_за_единицу
    )
VALUES (
        'MAT-001',
        'ЛДСП Белый 16мм',
        500,
        'лист',
        50,
        1500.00
    ),
    (
        'MAT-002',
        'ЛДСП Дуб 16мм',
        400,
        'лист',
        50,
        1800.00
    ),
    (
        'MAT-003',
        'ЛДСП Венге 16мм',
        350,
        'лист',
        40,
        1850.00
    ),
    (
        'MAT-004',
        'ЛДСП Орех 16мм',
        300,
        'лист',
        40,
        1750.00
    ),
    (
        'MAT-005',
        'МДФ 10мм Белый',
        250,
        'лист',
        30,
        1200.00
    ),
    (
        'MAT-006',
        'МДФ 16мм Белый',
        200,
        'лист',
        25,
        1600.00
    ),
    ('MAT-007', 'ДВП 3мм', 600, 'лист', 100, 350.00),
    (
        'MAT-008',
        'Кромка ПВХ 2мм белая',
        1000,
        'м.п.',
        200,
        25.00
    ),
    (
        'MAT-009',
        'Кромка ПВХ 2мм дуб',
        800,
        'м.п.',
        150,
        30.00
    ),
    (
        'MAT-010',
        'Кромка ПВХ 2мм венге',
        700,
        'м.п.',
        150,
        32.00
    ),
    (
        'MAT-011',
        'Петля мебельная накладная',
        2000,
        'шт',
        500,
        45.00
    ),
    (
        'MAT-012',
        'Петля мебельная вкладная',
        1500,
        'шт',
        400,
        55.00
    ),
    (
        'MAT-013',
        'Направляющие 300мм',
        400,
        'пара',
        100,
        280.00
    ),
    (
        'MAT-014',
        'Направляющие 400мм',
        500,
        'пара',
        100,
        350.00
    ),
    (
        'MAT-015',
        'Направляющие 500мм',
        350,
        'пара',
        80,
        420.00
    ),
    (
        'MAT-016',
        'Ручка-скоба 96мм',
        800,
        'шт',
        200,
        65.00
    ),
    (
        'MAT-017',
        'Ручка-скоба 128мм',
        1000,
        'шт',
        200,
        85.00
    ),
    ('MAT-018', 'Ручка-кнопка', 600, 'шт', 150, 45.00),
    (
        'MAT-019',
        'Конфирмат 7x50',
        5000,
        'шт',
        1000,
        2.50
    ),
    (
        'MAT-020',
        'Шуруп 3.5x16',
        10000,
        'шт',
        2000,
        0.80
    ),
    ('MAT-021', 'Эксцентрик', 3000, 'шт', 500, 8.00),
    (
        'MAT-022',
        'Стяжка межсекционная',
        2000,
        'шт',
        400,
        12.00
    ),
    (
        'MAT-023',
        'Стекло 4мм прозрачное',
        150,
        'лист',
        20,
        2500.00
    ),
    (
        'MAT-024',
        'Зеркало 4мм',
        100,
        'лист',
        15,
        3500.00
    ),
    (
        'MAT-025',
        'Ткань мебельная',
        300,
        'м.п.',
        50,
        850.00
    );
-- ============================================================================
-- 5. ЗАГОТОВКИ (Components) - 20 records
-- ============================================================================
INSERT INTO заготовки (
        артикул_заготовки,
        наименование,
        количество_готовых,
        описание
    )
VALUES (
        'ZAG-001',
        'Боковина шкафа 2200x600',
        50,
        'Боковая панель для шкафа-купе высотой 2200мм'
    ),
    (
        'ZAG-002',
        'Полка 800x400',
        120,
        'Полка внутренняя универсальная'
    ),
    (
        'ZAG-003',
        'Фасад 600x400',
        80,
        'Фасад с ручкой для тумбы'
    ),
    (
        'ZAG-004',
        'Столешница 1200x600',
        35,
        'Рабочая поверхность стола'
    ),
    (
        'ZAG-005',
        'Ножка стола (брус)',
        150,
        'Деревянная опора стола'
    ),
    (
        'ZAG-006',
        'Задняя стенка ДВП',
        200,
        'Задник для корпусной мебели'
    ),
    (
        'ZAG-007',
        'Царга стола',
        100,
        'Боковая часть рамы стола'
    ),
    (
        'ZAG-008',
        'Спинка стула',
        60,
        'Мягкая спинка для стула'
    ),
    (
        'ZAG-009',
        'Сиденье стула',
        65,
        'Мягкое сиденье для стула'
    ),
    (
        'ZAG-010',
        'Фасад ящика МДФ',
        90,
        'Фасад для выдвижного ящика'
    ),
    (
        'ZAG-011',
        'Дно ящика ДВП',
        150,
        'Дно для выдвижного ящика'
    ),
    (
        'ZAG-012',
        'Цоколь 600x100',
        80,
        'Декоративная планка цоколя'
    ),
    (
        'ZAG-013',
        'Ручка стула',
        70,
        'Подлокотник для стула'
    ),
    (
        'ZAG-014',
        'Клей для ткани',
        200,
        'Клеевой материал для обивки'
    ),
    (
        'ZAG-015',
        'Крышка стола 1200x700',
        40,
        'Большая столешница для письменного стола'
    ),
    (
        'ZAG-016',
        'Полка навесная 600x300',
        100,
        'Полка для навесного шкафа'
    ),
    (
        'ZAG-017',
        'Дверь шкафа ЛДСП',
        70,
        'Распашная дверь для шкафа'
    ),
    (
        'ZAG-018',
        'Перегородка внутренняя',
        90,
        'Разделитель для шкафа'
    ),
    (
        'ZAG-019',
        'Штанга для одежды',
        60,
        'Хромированная штанга'
    ),
    (
        'ZAG-020',
        'Ящик собранный',
        45,
        'Готовый выдвижной ящик'
    );
-- ============================================================================
-- 6. ИЗДЕЛИЯ (Products) - 15 records (no duplicates)
-- ============================================================================
INSERT INTO изделия (
        артикул_изделия,
        наименование,
        тип,
        размеры,
        стоимость
    )
VALUES (
        'IZD-001',
        'Шкаф-купе Классик',
        'Шкаф',
        '2200x1200x600',
        45000.00
    ),
    (
        'IZD-002',
        'Стол письменный Офис',
        'Стол',
        '1200x750x600',
        12000.00
    ),
    (
        'IZD-003',
        'Стул Комфорт',
        'Стул',
        '450x850x500',
        7930.00
    ),
    (
        'IZD-004',
        'Тумба прикроватная',
        'Тумба',
        '500x500x400',
        8000.00
    ),
    (
        'IZD-005',
        'Комод на 4 ящика',
        'Комод',
        '1000x800x450',
        18000.00
    ),
    (
        'IZD-006',
        'Стол обеденный раздвижной',
        'Стол',
        '1400x900x750',
        25000.00
    ),
    (
        'IZD-007',
        'Полка навесная',
        'Полка',
        '800x300x250',
        4500.00
    ),
    (
        'IZD-008',
        'Стеллаж офисный',
        'Стеллаж',
        '800x2000x400',
        15000.00
    ),
    (
        'IZD-009',
        'Шкаф-купе Лидер',
        'Шкаф',
        '2400x1800x650',
        65000.00
    ),
    (
        'IZD-010',
        'Комод 4 ящика',
        'Комод',
        '800x1000x500',
        22000.00
    ),
    (
        'IZD-011',
        'Стол письменный Ученик',
        'Стол',
        '1000x750x550',
        9500.00
    ),
    (
        'IZD-012',
        'Кровать двуспальная',
        'Кровать',
        '2000x1600x400',
        35000.00
    ),
    (
        'IZD-013',
        'Тумба ТВ',
        'Тумба',
        '1500x500x450',
        12000.00
    ),
    (
        'IZD-014',
        'Гардеробная система',
        'Шкаф',
        '3000x2400x600',
        95000.00
    ),
    (
        'IZD-015',
        'Кухонный гарнитур Эконом',
        'Кухня',
        '2400x2200x600',
        75000.00
    );
-- ============================================================================
-- 7. РАСХОД МАТЕРИАЛОВ (Materials per Component) - ~60 records
-- ============================================================================
INSERT INTO расход_материалов (id_заготовки, id_материала, количество_материала)
SELECT z.id_заготовки,
    m.id_материала,
    qty
FROM (
        VALUES ('ZAG-001', 'MAT-001', 3),
            ('ZAG-001', 'MAT-008', 8),
            ('ZAG-001', 'MAT-019', 20),
            ('ZAG-002', 'MAT-001', 1),
            ('ZAG-002', 'MAT-008', 4),
            ('ZAG-002', 'MAT-019', 8),
            ('ZAG-003', 'MAT-005', 1),
            ('ZAG-003', 'MAT-017', 1),
            ('ZAG-003', 'MAT-011', 2),
            ('ZAG-004', 'MAT-002', 2),
            ('ZAG-004', 'MAT-009', 5),
            ('ZAG-004', 'MAT-019', 12),
            ('ZAG-005', 'MAT-002', 1),
            ('ZAG-005', 'MAT-020', 8),
            ('ZAG-006', 'MAT-007', 1),
            ('ZAG-006', 'MAT-020', 16),
            ('ZAG-007', 'MAT-002', 1),
            ('ZAG-007', 'MAT-009', 3),
            ('ZAG-007', 'MAT-019', 6),
            ('ZAG-008', 'MAT-006', 1),
            ('ZAG-008', 'MAT-025', 1),
            ('ZAG-009', 'MAT-006', 1),
            ('ZAG-009', 'MAT-025', 1),
            ('ZAG-010', 'MAT-005', 1),
            ('ZAG-010', 'MAT-008', 3),
            ('ZAG-010', 'MAT-017', 1),
            ('ZAG-011', 'MAT-007', 1),
            ('ZAG-011', 'MAT-020', 8),
            ('ZAG-012', 'MAT-001', 1),
            ('ZAG-012', 'MAT-008', 2),
            ('ZAG-013', 'MAT-002', 1),
            ('ZAG-013', 'MAT-025', 1),
            ('ZAG-014', 'MAT-025', 2),
            ('ZAG-015', 'MAT-002', 2),
            ('ZAG-015', 'MAT-009', 6),
            ('ZAG-015', 'MAT-019', 16),
            ('ZAG-016', 'MAT-001', 1),
            ('ZAG-016', 'MAT-008', 3),
            ('ZAG-017', 'MAT-003', 1),
            ('ZAG-017', 'MAT-010', 4),
            ('ZAG-017', 'MAT-011', 3),
            ('ZAG-018', 'MAT-001', 1),
            ('ZAG-018', 'MAT-008', 4),
            ('ZAG-019', 'MAT-022', 2),
            ('ZAG-020', 'MAT-007', 1),
            ('ZAG-020', 'MAT-013', 1),
            ('ZAG-020', 'MAT-019', 12),
            ('ZAG-020', 'MAT-010', 1)
    ) AS v(арт_заг, арт_мат, qty)
    JOIN заготовки z ON z.артикул_заготовки = v.арт_заг
    JOIN материалы m ON m.артикул_материала = v.арт_мат ON CONFLICT (id_заготовки, id_материала) DO NOTHING;
-- ============================================================================
-- 8. СОСТАВ ИЗДЕЛИЯ (Components per Product) - ~50 records
-- ============================================================================
INSERT INTO состав_изделия (id_изделия, id_заготовки, количество_заготовки)
SELECT i.id_изделия,
    z.id_заготовки,
    qty
FROM (
        VALUES -- Шкаф-купе Классик
            ('IZD-001', 'ZAG-001', 2),
            ('IZD-001', 'ZAG-002', 6),
            ('IZD-001', 'ZAG-006', 1),
            ('IZD-001', 'ZAG-012', 1),
            ('IZD-001', 'ZAG-019', 1),
            -- Стол письменный Офис
            ('IZD-002', 'ZAG-004', 1),
            ('IZD-002', 'ZAG-005', 4),
            ('IZD-002', 'ZAG-007', 2),
            ('IZD-002', 'ZAG-020', 3),
            -- Стул Комфорт
            ('IZD-003', 'ZAG-008', 1),
            ('IZD-003', 'ZAG-009', 1),
            ('IZD-003', 'ZAG-013', 2),
            ('IZD-003', 'ZAG-014', 1),
            -- Тумба прикроватная
            ('IZD-004', 'ZAG-002', 2),
            ('IZD-004', 'ZAG-003', 1),
            ('IZD-004', 'ZAG-006', 1),
            ('IZD-004', 'ZAG-012', 1),
            -- Комод на 4 ящика
            ('IZD-005', 'ZAG-001', 2),
            ('IZD-005', 'ZAG-010', 4),
            ('IZD-005', 'ZAG-011', 4),
            ('IZD-005', 'ZAG-020', 4),
            ('IZD-005', 'ZAG-006', 1),
            -- Стол обеденный раздвижной
            ('IZD-006', 'ZAG-015', 2),
            ('IZD-006', 'ZAG-005', 4),
            ('IZD-006', 'ZAG-007', 4),
            -- Полка навесная
            ('IZD-007', 'ZAG-016', 3),
            ('IZD-007', 'ZAG-006', 1),
            -- Стеллаж офисный
            ('IZD-008', 'ZAG-001', 2),
            ('IZD-008', 'ZAG-002', 8),
            ('IZD-008', 'ZAG-006', 1),
            ('IZD-008', 'ZAG-012', 1),
            -- Шкаф-купе Лидер
            ('IZD-009', 'ZAG-001', 3),
            ('IZD-009', 'ZAG-002', 10),
            ('IZD-009', 'ZAG-017', 3),
            ('IZD-009', 'ZAG-018', 2),
            ('IZD-009', 'ZAG-019', 2),
            ('IZD-009', 'ZAG-006', 1),
            -- Комод 4 ящика
            ('IZD-010', 'ZAG-001', 2),
            ('IZD-010', 'ZAG-010', 4),
            ('IZD-010', 'ZAG-020', 4),
            ('IZD-010', 'ZAG-006', 1),
            ('IZD-010', 'ZAG-012', 1),
            -- Стол письменный Ученик
            ('IZD-011', 'ZAG-004', 1),
            ('IZD-011', 'ZAG-005', 4),
            ('IZD-011', 'ZAG-007', 2),
            ('IZD-011', 'ZAG-020', 2),
            -- Кровать двуспальная
            ('IZD-012', 'ZAG-001', 2),
            ('IZD-012', 'ZAG-008', 1),
            ('IZD-012', 'ZAG-002', 4),
            -- Тумба ТВ
            ('IZD-013', 'ZAG-001', 2),
            ('IZD-013', 'ZAG-002', 3),
            ('IZD-013', 'ZAG-003', 2),
            ('IZD-013', 'ZAG-006', 1),
            -- Гардеробная система
            ('IZD-014', 'ZAG-001', 6),
            ('IZD-014', 'ZAG-002', 15),
            ('IZD-014', 'ZAG-017', 4),
            ('IZD-014', 'ZAG-018', 4),
            ('IZD-014', 'ZAG-019', 3),
            ('IZD-014', 'ZAG-020', 8),
            -- Кухонный гарнитур Эконом
            ('IZD-015', 'ZAG-001', 4),
            ('IZD-015', 'ZAG-002', 10),
            ('IZD-015', 'ZAG-003', 6),
            ('IZD-015', 'ZAG-016', 4),
            ('IZD-015', 'ZAG-020', 6)
    ) AS v(арт_изд, арт_заг, qty)
    JOIN изделия i ON i.артикул_изделия = v.арт_изд
    JOIN заготовки z ON z.артикул_заготовки = v.арт_заг ON CONFLICT (id_изделия, id_заготовки) DO NOTHING;
-- ============================================================================
-- 9. ЗАКАЗЫ (Orders) - 100+ records
-- ============================================================================
DO $$
DECLARE i INTEGER;
client_id INTEGER;
manager_id INTEGER;
order_date DATE;
ready_date DATE;
status_val VARCHAR;
total NUMERIC;
statuses VARCHAR [] := ARRAY ['принят', 'в_работе', 'в_обработке', 'выполнен', 'отгружен'];
BEGIN FOR i IN 1..120 LOOP -- Random client
SELECT id_клиента INTO client_id
FROM клиенты
ORDER BY random()
LIMIT 1;
-- Random manager
SELECT id_сотрудника INTO manager_id
FROM сотрудники
WHERE должность = 'менеджер'
ORDER BY random()
LIMIT 1;
-- Random dates
order_date := CURRENT_DATE - (random() * 60)::INTEGER;
ready_date := order_date + 7 + (random() * 14)::INTEGER;
-- Random status based on date
IF ready_date < CURRENT_DATE THEN status_val := statuses [3 + (random() * 2)::INTEGER];
-- выполнен or отгружен
ELSIF order_date < CURRENT_DATE - 7 THEN status_val := statuses [2 + (random() * 2)::INTEGER];
-- в_работе or в_обработке
ELSE status_val := statuses [1 + (random() * 2)::INTEGER];
-- принят or в_работе
END IF;
-- Random total
total := 10000 + (random() * 100000)::INTEGER;
INSERT INTO заказы (
        id_клиента,
        id_менеджера,
        дата_заказа,
        дата_готовности,
        статус,
        сумма_заказа,
        примечания
    )
VALUES (
        client_id,
        manager_id,
        order_date,
        ready_date,
        status_val,
        total,
        'Заказ #' || i
    );
END LOOP;
END $$;
-- ============================================================================
-- 10. СОСТАВ ЗАКАЗА (Order Items) - Multiple items per order
-- ============================================================================
DO $$
DECLARE order_rec RECORD;
product_id INTEGER;
items_count INTEGER;
i INTEGER;
BEGIN FOR order_rec IN
SELECT id_заказа
FROM заказы LOOP -- 1-4 items per order
    items_count := 1 + (random() * 3)::INTEGER;
FOR i IN 1..items_count LOOP
SELECT id_изделия INTO product_id
FROM изделия
ORDER BY random()
LIMIT 1;
INSERT INTO состав_заказа (
        id_заказа,
        id_изделия,
        цена_фиксированная,
        количество_изделий
    )
SELECT order_rec.id_заказа,
    product_id,
    стоимость,
    1 + (random() * 2)::INTEGER
FROM изделия
WHERE id_изделия = product_id ON CONFLICT (id_заказа, id_изделия) DO
UPDATE
SET количество_изделий = состав_заказа.количество_изделий + 1;
END LOOP;
END LOOP;
END $$;
-- Update order totals
UPDATE заказы
SET сумма_заказа = (
        SELECT COALESCE(
                SUM(sz.цена_фиксированная * sz.количество_изделий),
                0
            )
        FROM состав_заказа sz
        WHERE sz.id_заказа = заказы.id_заказа
    );
-- ============================================================================
-- 11. ПЛАН ЗАГОТОВОК (Production Plan) - Auto-generated from orders
-- ============================================================================
INSERT INTO план_заготовок (
        id_заготовки,
        id_заказа,
        id_сотрудника,
        плановое_количество,
        дата_план,
        статус
    )
SELECT DISTINCT ON (si.id_заготовки, sz.id_заказа) si.id_заготовки,
    sz.id_заказа,
    (
        SELECT id_сотрудника
        FROM сотрудники
        WHERE должность = 'сборщик'
        ORDER BY random()
        LIMIT 1
    ), SUM(si.количество_заготовки * sz.количество_изделий), o.дата_готовности - INTERVAL '3 days',
    CASE
        WHEN o.статус IN ('выполнен', 'отгружен') THEN 'выполнено'
        WHEN o.статус = 'в_работе' THEN 'в_работе'
        ELSE 'принято'
    END
FROM состав_заказа sz
    JOIN состав_изделия si ON sz.id_изделия = si.id_изделия
    JOIN заказы o ON sz.id_заказа = o.id_заказа
WHERE o.статус NOT IN ('отменен')
GROUP BY si.id_заготовки,
    sz.id_заказа,
    o.дата_готовности,
    o.статус ON CONFLICT (id_заготовки, id_заказа) DO NOTHING;
-- ============================================================================
-- 12. ЗАКУПКИ МАТЕРИАЛОВ (Purchases) - 20 records
-- ============================================================================
INSERT INTO закупки_материалов (дата_закупки, поставщик, статус)
VALUES (CURRENT_DATE - 30, 'ООО ЛесТорг', 'выполнено'),
    (
        CURRENT_DATE - 28,
        'ИП Фурнитура Плюс',
        'выполнено'
    ),
    (
        CURRENT_DATE - 25,
        'ООО ЛДСП-Маркет',
        'выполнено'
    ),
    (
        CURRENT_DATE - 22,
        'ООО МебельКомплект',
        'выполнено'
    ),
    (CURRENT_DATE - 20, 'ИП Метизы.ру', 'выполнено'),
    (CURRENT_DATE - 18, 'ООО ЛесТорг', 'выполнено'),
    (
        CURRENT_DATE - 15,
        'ООО Текстиль Мебель',
        'выполнено'
    ),
    (
        CURRENT_DATE - 12,
        'ИП Фурнитура Плюс',
        'выполнено'
    ),
    (
        CURRENT_DATE - 10,
        'ООО ЛДСП-Маркет',
        'выполнено'
    ),
    (
        CURRENT_DATE - 8,
        'ООО МебельКомплект',
        'выполнено'
    ),
    (CURRENT_DATE - 5, 'ИП Метизы.ру', 'подтверждено'),
    (CURRENT_DATE - 3, 'ООО ЛесТорг', 'подтверждено'),
    (
        CURRENT_DATE - 2,
        'ООО Текстиль Мебель',
        'подтверждено'
    ),
    (
        CURRENT_DATE - 1,
        'ИП Фурнитура Плюс',
        'ожидает_подтверждения'
    ),
    (
        CURRENT_DATE,
        'ООО ЛДСП-Маркет',
        'ожидает_подтверждения'
    ),
    (
        CURRENT_DATE,
        'ООО МебельКомплект',
        'ожидает_подтверждения'
    ),
    (
        CURRENT_DATE + 1,
        'ИП Метизы.ру',
        'ожидает_подтверждения'
    ),
    (
        CURRENT_DATE + 2,
        'ООО ЛесТорг',
        'ожидает_подтверждения'
    ),
    (
        CURRENT_DATE + 3,
        'ООО Текстиль Мебель',
        'ожидает_подтверждения'
    ),
    (
        CURRENT_DATE + 5,
        'ИП Фурнитура Плюс',
        'ожидает_подтверждения'
    );
-- ============================================================================
-- 13. СОСТАВ ЗАКУПКИ (Purchase Items)
-- ============================================================================
DO $$
DECLARE purchase_rec RECORD;
mat_id INTEGER;
items_count INTEGER;
i INTEGER;
BEGIN FOR purchase_rec IN
SELECT id_закупки
FROM закупки_материалов LOOP -- 2-6 materials per purchase
    items_count := 2 + (random() * 4)::INTEGER;
FOR i IN 1..items_count LOOP
SELECT id_материала INTO mat_id
FROM материалы
ORDER BY random()
LIMIT 1;
INSERT INTO состав_закупки (
        id_закупки,
        id_материала,
        количество,
        цена_закупки
    )
SELECT purchase_rec.id_закупки,
    mat_id,
    10 + (random() * 90)::INTEGER,
    цена_за_единицу * 0.8
FROM материалы
WHERE id_материала = mat_id ON CONFLICT (id_закупки, id_материала) DO NOTHING;
END LOOP;
END LOOP;
END $$;
COMMIT;
-- ============================================================================
-- VERIFICATION
-- ============================================================================
SELECT 'сотрудники' as table_name,
    COUNT(*) as cnt
FROM сотрудники
UNION ALL
SELECT 'клиенты',
    COUNT(*)
FROM клиенты
UNION ALL
SELECT 'материалы',
    COUNT(*)
FROM материалы
UNION ALL
SELECT 'заготовки',
    COUNT(*)
FROM заготовки
UNION ALL
SELECT 'изделия',
    COUNT(*)
FROM изделия
UNION ALL
SELECT 'расход_материалов',
    COUNT(*)
FROM расход_материалов
UNION ALL
SELECT 'состав_изделия',
    COUNT(*)
FROM состав_изделия
UNION ALL
SELECT 'заказы',
    COUNT(*)
FROM заказы
UNION ALL
SELECT 'состав_заказа',
    COUNT(*)
FROM состав_заказа
UNION ALL
SELECT 'план_заготовок',
    COUNT(*)
FROM план_заготовок
UNION ALL
SELECT 'закупки_материалов',
    COUNT(*)
FROM закупки_материалов
UNION ALL
SELECT 'состав_закупки',
    COUNT(*)
FROM состав_закупки
ORDER BY table_name;