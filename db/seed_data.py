import os
import random
import sys
from datetime import date, timedelta

import bcrypt
import psycopg2
from faker import Faker

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—É—Ç–µ–π
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
from config import config

fake = Faker("ru_RU")


def hash_password(password):
    salt = bcrypt.gensalt()
    return bcrypt.hashpw(password.encode(), salt).decode()


def seed():
    conn = psycopg2.connect(config.DATABASE_URL)
    cur = conn.cursor()

    print("üßπ –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü (TRUNCATE)...")
    tables = [
        "–ø–ª–∞–Ω_–∑–∞–≥–æ—Ç–æ–≤–æ–∫",
        "—Å–æ—Å—Ç–∞–≤_–∑–∞–∫—É–ø–∫–∏",
        "–∑–∞–∫—É–ø–∫–∏_–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",
        "–≥—Ä–∞—Ñ–∏–∫_—Ä–∞–±–æ—Ç—ã",
        "—Å–æ—Å—Ç–∞–≤_–∑–∞–∫–∞–∑–∞",
        "—Å–æ—Å—Ç–∞–≤_–∏–∑–¥–µ–ª–∏—è",
        "—Ä–∞—Å—Ö–æ–¥_–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤",
        "–∑–∞–∫–∞–∑—ã",
        "–∏–∑–¥–µ–ª–∏—è",
        "–∑–∞–≥–æ—Ç–æ–≤–∫–∏",
        "–º–∞—Ç–µ—Ä–∏–∞–ª—ã",
        "–∫–ª–∏–µ–Ω—Ç—ã",
        "—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏",
    ]
    for table in tables:
        cur.execute(f"TRUNCATE TABLE {table} RESTART IDENTITY CASCADE;")

    # --- 1. –ú–ê–¢–ï–†–ò–ê–õ–´ (–º–∏–Ω–∏–º—É–º 20) ---
    print("üå± 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...")
    base_materials = [
        ("–î–°–ü –ë–µ–ª—ã–π", "–ª–∏—Å—Ç", 1500),
        ("–î–°–ü –î—É–± –°–æ–Ω–æ–º–∞", "–ª–∏—Å—Ç", 1800),
        ("–î–°–ü –í–µ–Ω–≥–µ", "–ª–∏—Å—Ç", 1900),
        ("–î–°–ü –û—Ä–µ—Ö", "–ª–∏—Å—Ç", 1750),
        ("–ú–î–§ –ì–ª—è–Ω–µ—Ü", "–ª–∏—Å—Ç", 3500),
        ("–§–∞–Ω–µ—Ä–∞ 10–º–º", "–ª–∏—Å—Ç", 900),
        ("–ë—Ä—É—Å —Å–æ—Å–Ω–æ–≤—ã–π 50—Ö50", "–º", 120),
        ("–ö—Ä–æ–º–∫–∞ –ü–í–• 2–º–º", "–º", 40),
        ("–ö—Ä–æ–º–∫–∞ –ú–µ–ª–∞–º–∏–Ω", "–º", 15),
        ("–°–∞–º–æ—Ä–µ–∑—ã 3.5—Ö16", "—à—Ç", 1),
        ("–°–∞–º–æ—Ä–µ–∑—ã 4—Ö30", "—à—Ç", 2),
        ("–ï–≤—Ä–æ–≤–∏–Ω—Ç (–ö–æ–Ω—Ñ–∏—Ä–º–∞—Ç)", "—à—Ç", 5),
        ("–≠–∫—Å—Ü–µ–Ω—Ç—Ä–∏–∫–æ–≤–∞—è —Å—Ç—è–∂–∫–∞", "—à—Ç", 15),
        ("–®–∫–∞–Ω—Ç –¥–µ—Ä–µ–≤—è–Ω–Ω—ã–π", "—à—Ç", 2),
        ("–ö–ª–µ–π –ü–í–ê –°—Ç–æ–ª—è—Ä", "–ª", 450),
        ("–õ–∞–∫ –ü–æ–ª–∏—É—Ä–µ—Ç–∞–Ω–æ–≤—ã–π", "–ª", 1200),
        ("–ö—Ä–∞—Å–∫–∞ –ê–∫—Ä–∏–ª–æ–≤–∞—è", "–ª", 900),
        ("–†—É—á–∫–∞ –°–∫–æ–±–∞ —Ö—Ä–æ–º", "—à—Ç", 150),
        ("–†—É—á–∫–∞ –ö–Ω–æ–ø–∫–∞", "—à—Ç", 80),
        ("–ü–µ—Ç–ª—è –Ω–∞–∫–ª–∞–¥–Ω–∞—è —Å –¥–æ–≤–æ–¥—á–∏–∫–æ–º", "—à—Ç", 180),
        ("–ü–µ—Ç–ª—è –≤–∫–ª–∞–¥–Ω–∞—è", "—à—Ç", 120),
        ("–ù–∞–ø—Ä–∞–≤–ª—è—é—â–∏–µ —à–∞—Ä–∏–∫–æ–≤—ã–µ 450–º–º", "–∫–æ–º–ø–ª", 400),
        ("–û–ø–æ—Ä–∞ –∫–æ–ª–µ—Å–Ω–∞—è", "—à—Ç", 120),
        ("–¢—Ä—É–±–∞ –î–∂–æ–∫–µ—Ä 25–º–º", "–º", 300),
    ]

    material_ids = []
    for name, unit, price in base_materials:
        cur.execute(
            """
            INSERT INTO –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–∞—Ä—Ç–∏–∫—É–ª_–º–∞—Ç–µ—Ä–∏–∞–ª–∞, –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–Ω–∞_—Å–∫–ª–∞–¥–µ, –µ–¥–∏–Ω–∏—Ü–∞_–∏–∑–º–µ—Ä–µ–Ω–∏—è, —Ü–µ–Ω–∞_–∑–∞_–µ–¥–∏–Ω–∏—Ü—É)
            VALUES (%s, %s, %s, %s, %s) RETURNING id_–º–∞—Ç–µ—Ä–∏–∞–ª–∞
        """,
            (fake.unique.ean8(), name, random.randint(0, 1000), unit, price),
        )
        material_ids.append(cur.fetchone()[0])

    # --- 2. –ó–ê–ì–û–¢–û–í–ö–ò ---
    print("üå± 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–≥–æ—Ç–æ–≤–æ–∫ –∏ —Ä–∞—Å—Ö–æ–¥–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤...")
    zagotovki_names = [
        "–ë–æ–∫–æ–≤–∏–Ω–∞ —à–∫–∞—Ñ–∞ 2200—Ö600",
        "–ü–æ–ª–∫–∞ 568—Ö500",
        "–î–≤–µ—Ä—å —à–∫–∞—Ñ–∞ –õ–î–°–ü",
        "–¶–æ–∫–æ–ª—å 600—Ö100",
        "–ö—Ä—ã—à–∫–∞ —Å—Ç–æ–ª–∞ 1200—Ö700",
        "–ù–æ–∂–∫–∞ —Å—Ç–æ–ª–∞ (–±—Ä—É—Å)",
        "–¶–∞—Ä–≥–∞ —Å—Ç–æ–ª–∞",
        "–°–ø–∏–Ω–∫–∞ —Å—Ç—É–ª–∞",
        "–°–∏–¥–µ–Ω—å–µ —Å—Ç—É–ª–∞",
        "–§–∞—Å–∞–¥ —è—â–∏–∫–∞ –ú–î–§",
        "–î–Ω–æ —è—â–∏–∫–∞ –î–í–ü",
        "–ó–∞–¥–Ω—è—è —Å—Ç–µ–Ω–∫–∞ –î–í–ü",
    ]
    zagotovki_ids = []

    for z_name in zagotovki_names:
        cur.execute(
            """
            INSERT INTO –∑–∞–≥–æ—Ç–æ–≤–∫–∏ (–∞—Ä—Ç–∏–∫—É–ª_–∑–∞–≥–æ—Ç–æ–≤–∫–∏, –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–≥–æ—Ç–æ–≤—ã—Ö, –æ–ø–∏—Å–∞–Ω–∏–µ)
            VALUES (%s, %s, %s, %s) RETURNING id_–∑–∞–≥–æ—Ç–æ–≤–∫–∏
        """,
            (
                fake.unique.ean8(),
                z_name,
                random.randint(0, 50),
                fake.text(max_nb_chars=50),
            ),
        )
        z_id = cur.fetchone()[0]
        zagotovki_ids.append(z_id)

        # –°–≤—è–∑—å: –ó–∞–≥–æ—Ç–æ–≤–∫–∞ -> –ú–∞—Ç–µ—Ä–∏–∞–ª—ã (—Ä–∞—Å—Ö–æ–¥)
        # –ö–∞–∂–¥–∞—è –∑–∞–≥–æ—Ç–æ–≤–∫–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 1-3 —Å–ª—É—á–∞–π–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
        used_mats = random.sample(material_ids, k=random.randint(1, 3))
        for m_id in used_mats:
            cur.execute(
                """
                INSERT INTO —Ä–∞—Å—Ö–æ–¥_–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (id_–∑–∞–≥–æ—Ç–æ–≤–∫–∏, id_–º–∞—Ç–µ—Ä–∏–∞–ª–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–º–∞—Ç–µ—Ä–∏–∞–ª–∞)
                VALUES (%s, %s, %s)
            """,
                (z_id, m_id, random.randint(1, 5)),
            )

    # --- 3. –ò–ó–î–ï–õ–ò–Ø ---
    print("üå± 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–¥–µ–ª–∏–π –∏ –∏—Ö —Å–æ—Å—Ç–∞–≤–∞...")
    products_base = [
        ("–®–∫–∞—Ñ-–∫—É–ø–µ '–õ–∏–¥–µ—Ä'", "—à–∫–∞—Ñ"),
        ("–°—Ç–æ–ª –ø–∏—Å—å–º–µ–Ω–Ω—ã–π '–£—á–µ–Ω–∏–∫'", "—Å—Ç–æ–ª"),
        ("–°—Ç—É–ª '–ö–æ–º—Ñ–æ—Ä—Ç'", "—Å—Ç—É–ª"),
        ("–¢—É–º–±–∞ –ø—Ä–∏–∫—Ä–æ–≤–∞—Ç–Ω–∞—è", "—à–∫–∞—Ñ"),
        ("–ö–æ–º–æ–¥ –Ω–∞ 4 —è—â–∏–∫–∞", "—à–∫–∞—Ñ"),
        ("–°—Ç–æ–ª –æ–±–µ–¥–µ–Ω–Ω—ã–π —Ä–∞–∑–¥–≤–∏–∂–Ω–æ–π", "—Å—Ç–æ–ª"),
        ("–ü–æ–ª–∫–∞ –Ω–∞–≤–µ—Å–Ω–∞—è", "—à–∫–∞—Ñ"),
        ("–°—Ç–µ–ª–ª–∞–∂ –æ—Ñ–∏—Å–Ω—ã–π", "—à–∫–∞—Ñ"),
    ]
    product_ids = []

    for p_name, p_type in products_base:
        cur.execute(
            """
            INSERT INTO –∏–∑–¥–µ–ª–∏—è (–∞—Ä—Ç–∏–∫—É–ª_–∏–∑–¥–µ–ª–∏—è, –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, —Ç–∏–ø, —Ä–∞–∑–º–µ—Ä—ã, —Å—Ç–æ–∏–º–æ—Å—Ç—å)
            VALUES (%s, %s, %s, %s, %s) RETURNING id_–∏–∑–¥–µ–ª–∏—è
        """,
            (
                fake.unique.ean8(),
                p_name,
                p_type,
                f"{random.randint(500,2000)}x{random.randint(400,1000)}x{random.randint(400,2200)}",
                random.randint(3000, 45000),
            ),
        )
        p_id = cur.fetchone()[0]
        product_ids.append(p_id)

        # –°–≤—è–∑—å: –ò–∑–¥–µ–ª–∏–µ -> –ó–∞–≥–æ—Ç–æ–≤–∫–∏ (—Å–æ—Å—Ç–∞–≤ –∏–∑–¥–µ–ª–∏—è)
        # –ö–∞–∂–¥–æ–µ –∏–∑–¥–µ–ª–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ 2-5 —Å–ª—É—á–∞–π–Ω—ã—Ö –∑–∞–≥–æ—Ç–æ–≤–æ–∫
        used_zags = random.sample(zagotovki_ids, k=random.randint(2, 5))
        for z_id in used_zags:
            cur.execute(
                """
                INSERT INTO —Å–æ—Å—Ç–∞–≤_–∏–∑–¥–µ–ª–∏—è (id_–∏–∑–¥–µ–ª–∏—è, id_–∑–∞–≥–æ—Ç–æ–≤–∫–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∑–∞–≥–æ—Ç–æ–≤–æ–∫)
                VALUES (%s, %s, %s)
            """,
                (p_id, z_id, random.randint(1, 4)),
            )

    # --- 4. –°–û–¢–†–£–î–ù–ò–ö–ò ---
    print("üå± 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ (–°—Ç—Ä–æ–≥–æ: 2 –î–∏—Ä, 8 –ú–µ–Ω, 5 –°–±–æ—Ä)...")
    employees_ids = []

    # –°–ø–∏—Å–æ–∫ —Ä–æ–ª–µ–π –≤ –Ω—É–∂–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ
    roles_distribution = ["–¥–∏—Ä–µ–∫—Ç–æ—Ä"] * 2 + ["–º–µ–Ω–µ–¥–∂–µ—Ä"] * 8 + ["—Å–±–æ—Ä—â–∏–∫"] * 5
    # –ü–µ—Ä–µ–º–µ—à–∞–µ–º, —á—Ç–æ–±—ã –æ–Ω–∏ —à–ª–∏ –Ω–µ –ø–æ –ø–æ—Ä—è–¥–∫—É ID, –∏–ª–∏ –æ—Å—Ç–∞–≤–∏–º –∫–∞–∫ –µ—Å—Ç—å?
    # –õ—É—á—à–µ –æ—Å—Ç–∞–≤–∏–º –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏ –≤ –ë–î.

    for i, role in enumerate(roles_distribution):
        gender = random.choice(["M", "F"])
        if gender == "M":
            fio = fake.first_name_male() + " " + fake.last_name_male()
        else:
            fio = fake.first_name_female() + " " + fake.last_name_female()

        # –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–¥–∏–º –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ –ª–æ–≥–∏–Ω—ã
        if i == 0:
            login = "director"
            fio = "–î–∏—Ä–µ–∫—Ç–æ—Ä –ò–≤–∞–Ω"
        elif i == 2:
            login = "manager"
            fio = "–ú–µ–Ω–µ–¥–∂–µ—Ä –ê–Ω–Ω–∞"
        elif i == 10:
            login = "worker"
            fio = "–°–±–æ—Ä—â–∏–∫ –ü–µ—Ç—Ä"
        else:
            login = f"user_{i+1}"

        hashed = hash_password("123")

        cur.execute(
            """
            INSERT INTO —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ (—Ñ–∏–æ, –Ω–æ–º–µ—Ä_—Ç–µ–ª–µ—Ñ–æ–Ω–∞, –¥–∞—Ç–∞_—Ä–æ–∂–¥–µ–Ω–∏—è, –¥–æ–ª–∂–Ω–æ—Å—Ç—å, –∑–∞—Ä–ø–ª–∞—Ç–∞, –¥–∞—Ç–∞_–Ω–∞–π–º–∞, login, password_hash)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s) RETURNING id_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        """,
            (
                fio,
                fake.unique.phone_number(),
                fake.date_of_birth(minimum_age=18, maximum_age=60),
                role,  # –†–æ–ª—å –∏–∑ –Ω–∞—à–µ–≥–æ —Å–ø–∏—Å–∫–∞
                random.randint(40000, 150000),
                fake.date_between(start_date="-5y", end_date="today"),
                login,
                hashed,
            ),
        )
        employees_ids.append(cur.fetchone()[0])

    # --- 5. –ì–†–ê–§–ò–ö –†–ê–ë–û–¢–´ (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 5/2) ---
    print("üå± 5. –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞ (–°–ë/–í–° - –≤—ã—Ö–æ–¥–Ω–æ–π)...")
    today = date.today()
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≥—Ä–∞—Ñ–∏–∫ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–µ—Å—è—Ü –∏ —Å–ª–µ–¥—É—é—â–∏–π
    start_date = today.replace(day=1)  # –ü–µ—Ä–≤–æ–µ —á–∏—Å–ª–æ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞
    days_to_generate = 60

    for emp_id in employees_ids:
        for day_offset in range(days_to_generate):
            current_day = start_date + timedelta(days=day_offset)
            weekday = current_day.weekday()  # 0=–ü–ù, 5=–°–ë, 6=–í–°

            # –õ–æ–≥–∏–∫–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
            if weekday >= 5:
                status = "–≤—ã—Ö–æ–¥–Ω–æ–π"
            else:
                status = "—Ä–∞–±–æ—á–∏–π"

            cur.execute(
                """
                INSERT INTO –≥—Ä–∞—Ñ–∏–∫_—Ä–∞–±–æ—Ç—ã (id_—Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞, –¥–∞—Ç–∞, —Å—Ç–∞—Ç—É—Å)
                VALUES (%s, %s, %s)
            """,
                (emp_id, current_day, status),
            )

    # --- 6. –ö–õ–ò–ï–ù–¢–´ (–º–∏–Ω–∏–º—É–º 100) ---
    print("üå± 6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (100+)...")
    client_ids = []
    for _ in range(110):  # –° –∑–∞–ø–∞—Å–æ–º
        gender = random.choice(["M", "F"])
        if gender == "M":
            name = f"{fake.last_name_male()} {fake.first_name_male()} {fake.middle_name_male()}"
        else:
            name = f"{fake.last_name_female()} {fake.first_name_female()} {fake.middle_name_female()}"

        cur.execute(
            """
            INSERT INTO –∫–ª–∏–µ–Ω—Ç—ã (—Ñ–∏–æ, –Ω–æ–º–µ—Ä_—Ç–µ–ª–µ—Ñ–æ–Ω–∞, –∞–¥—Ä–µ—Å, –¥–∞—Ç–∞_—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –∏–Ω–Ω)
            VALUES (%s, %s, %s, %s, %s) RETURNING id_–∫–ª–∏–µ–Ω—Ç–∞
        """,
            (
                name,
                fake.phone_number(),
                fake.address(),
                fake.date_between(start_date="-2y"),
                fake.unique.random_number(digits=12, fix_len=True),
            ),
        )
        client_ids.append(cur.fetchone()[0])

    # --- 7. –ó–ê–ö–ê–ó–´ –∏ –°–û–°–¢–ê–í –ó–ê–ö–ê–ó–ê (–º–∏–Ω–∏–º—É–º 100) ---
    print("üå± 7. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–∫–∞–∑–æ–≤ (—É–º–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã)...")
    order_ids = []

    # –í–µ—Å–∞ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤: –±–æ–ª—å—à–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö, –º–∞–ª–æ –æ—Ç–º–µ–Ω–µ–Ω–Ω—ã—Ö
    statuses = ["–ø—Ä–∏–Ω—è—Ç", "–≤_—Ä–∞–±–æ—Ç–µ", "–≤—ã–ø–æ–ª–Ω–µ–Ω", "–æ—Ç–≥—Ä—É–∂–µ–Ω", "–∑–∞–≤–µ—Ä—à–µ–Ω", "–æ—Ç–º–µ–Ω–µ–Ω"]
    weights = [0.15, 0.25, 0.15, 0.10, 0.30, 0.05]

    for _ in range(120):
        client = random.choice(client_ids)
        manager = random.choice(employees_ids)

        # –í—ã–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ç—É—Å —Å —É—á–µ—Ç–æ–º –≤–µ—Å–æ–≤
        status = random.choices(statuses, weights=weights, k=1)[0]

        # –õ–æ–≥–∏–∫–∞ –¥–∞—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç–∞—Ç—É—Å–∞
        if status in ["–∑–∞–≤–µ—Ä—à–µ–Ω", "–æ—Ç–≥—Ä—É–∂–µ–Ω", "–≤—ã–ø–æ–ª–Ω–µ–Ω", "–æ—Ç–º–µ–Ω–µ–Ω"]:
            # –°—Ç–∞—Ä—ã–µ –∑–∞–∫–∞–∑—ã (–±—ã–ª–∏ —Å–¥–µ–ª–∞–Ω—ã –≤ –ø—Ä–æ—à–ª–æ–º)
            d_order = fake.date_between(start_date="-60d", end_date="-10d")
            # –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –±—ã–ª–∞ —á–µ—Ä–µ–∑ 5-10 –¥–Ω–µ–π –ø–æ—Å–ª–µ –∑–∞–∫–∞–∑–∞
            d_ready = d_order + timedelta(days=random.randint(5, 10))
        else:
            # –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã (—Å–¥–µ–ª–∞–Ω—ã –Ω–µ–¥–∞–≤–Ω–æ)
            d_order = fake.date_between(start_date="-10d", end_date="today")

            # –®–∞–Ω—Å –Ω–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É (10%)
            if random.random() < 0.1:
                # –î–µ–¥–ª–∞–π–Ω –±—ã–ª –≤—á–µ—Ä–∞ (–ü—Ä–æ—Å—Ä–æ—á–µ–Ω)
                d_ready = d_order + timedelta(days=random.randint(1, 3))
            else:
                # –î–µ–¥–ª–∞–π–Ω –≤ –±—É–¥—É—â–µ–º (–í –Ω–æ—Ä–º–µ)
                d_ready = date.today() + timedelta(days=random.randint(5, 20))

        cur.execute(
            """
            INSERT INTO –∑–∞–∫–∞–∑—ã (id_–∫–ª–∏–µ–Ω—Ç–∞, id_–º–µ–Ω–µ–¥–∂–µ—Ä–∞, –¥–∞—Ç–∞_–∑–∞–∫–∞–∑–∞, –¥–∞—Ç–∞_–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏, —Å—Ç–∞—Ç—É—Å, —Å—É–º–º–∞_–∑–∞–∫–∞–∑–∞)
            VALUES (%s, %s, %s, %s, %s, %s) RETURNING id_–∑–∞–∫–∞–∑–∞
        """,
            (client, manager, d_order, d_ready, status, 0),
        )
        o_id = cur.fetchone()[0]
        order_ids.append(o_id)

        # –°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞: 1-5 –∏–∑–¥–µ–ª–∏–π
        items_count = random.randint(1, 5)
        total_sum = 0
        used_products = random.sample(product_ids, k=items_count)

        for p_id in used_products:
            cur.execute("SELECT —Å—Ç–æ–∏–º–æ—Å—Ç—å FROM –∏–∑–¥–µ–ª–∏—è WHERE id_–∏–∑–¥–µ–ª–∏—è = %s", (p_id,))
            price = cur.fetchone()[0]
            qty = random.randint(1, 4)

            cur.execute(
                """
                INSERT INTO —Å–æ—Å—Ç–∞–≤_–∑–∞–∫–∞–∑–∞ (id_–∑–∞–∫–∞–∑–∞, id_–∏–∑–¥–µ–ª–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∏–∑–¥–µ–ª–∏–π, —Ü–µ–Ω–∞_—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
                VALUES (%s, %s, %s, %s)
            """,
                (o_id, p_id, qty, price),
            )
            total_sum += price * qty

        cur.execute(
            "UPDATE –∑–∞–∫–∞–∑—ã SET —Å—É–º–º–∞_–∑–∞–∫–∞–∑–∞ = %s WHERE id_–∑–∞–∫–∞–∑–∞ = %s",
            (total_sum, o_id),
        )

    # --- 8. –ü–õ–ê–ù –ó–ê–ì–û–¢–û–í–û–ö ---
    print("üå± 8. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–ª–∞–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞...")
    # –ë–µ—Ä–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã
    for o_id in order_ids[:50]:  # –î–ª—è –ø–æ–ª–æ–≤–∏–Ω—ã –∑–∞–∫–∞–∑–æ–≤ —Å–æ–∑–¥–∞–¥–∏–º –ø–ª–∞–Ω
        # –ü–æ–ª—É—á–∞–µ–º –∏–∑–¥–µ–ª–∏—è –∑–∞–∫–∞–∑–∞
        cur.execute(
            "SELECT id_–∏–∑–¥–µ–ª–∏—è, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∏–∑–¥–µ–ª–∏–π FROM —Å–æ—Å—Ç–∞–≤_–∑–∞–∫–∞–∑–∞ WHERE id_–∑–∞–∫–∞–∑–∞ = %s",
            (o_id,),
        )
        order_items = cur.fetchall()

        for p_id, p_qty in order_items:
            # –ü–æ–ª—É—á–∞–µ–º –∑–∞–≥–æ—Ç–æ–≤–∫–∏ –¥–ª—è –∏–∑–¥–µ–ª–∏—è
            cur.execute(
                "SELECT id_–∑–∞–≥–æ—Ç–æ–≤–∫–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ_–∑–∞–≥–æ—Ç–æ–≤–æ–∫ FROM —Å–æ—Å—Ç–∞–≤_–∏–∑–¥–µ–ª–∏—è WHERE id_–∏–∑–¥–µ–ª–∏—è = %s",
                (p_id,),
            )
            parts = cur.fetchall()

            for z_id, z_qty_per_item in parts:
                total_parts_needed = p_qty * z_qty_per_item
                assembler = random.choice(employees_ids)

                cur.execute(
                    """
                    INSERT INTO –ø–ª–∞–Ω_–∑–∞–≥–æ—Ç–æ–≤–æ–∫ (id_–∑–∞–∫–∞–∑–∞, id_–∑–∞–≥–æ—Ç–æ–≤–∫–∏, id_—Å–±–æ—Ä—â–∏–∫–∞, –ø–ª–∞–Ω–æ–≤–æ–µ_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ_–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, –¥–∞—Ç–∞_–ø–ª–∞–Ω, —Å—Ç–∞—Ç—É—Å)
                    VALUES (%s, %s, %s, %s, %s, %s, %s)
                """,
                    (
                        o_id,
                        z_id,
                        assembler,
                        total_parts_needed,
                        random.randint(0, total_parts_needed),
                        fake.future_date(end_date="+14d"),
                        random.choice(["–ø—Ä–∏–Ω—è—Ç–æ", "–≤_—Ä–∞–±–æ—Ç–µ", "–≤—ã–ø–æ–ª–Ω–µ–Ω–æ"]),
                    ),
                )

    # --- 9. –ó–ê–ö–£–ü–ö–ò –ò –°–û–°–¢–ê–í ---
    print("üå± 9. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–∞–∫—É–ø–æ–∫...")
    suppliers = [
        "–û–û–û '–õ–µ—Å–°–Ω–∞–±'",
        "–ò–ü –ü–µ—Ç—Ä–æ–≤ (–§—É—Ä–Ω–∏—Ç—É—Ä–∞)",
        "–ó–ê–û '–•–∏–º–ü—Ä–æ–¥—É–∫—Ç'",
        "–ú–µ—Ç–∞–ª–ª–ö–æ–º–ø–ª–µ–∫—Ç",
    ]

    for _ in range(20):
        cur.execute(
            """
            INSERT INTO –∑–∞–∫—É–ø–∫–∏_–º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–ø–æ—Å—Ç–∞–≤—â–∏–∫, —Å—Ç–∞—Ç—É—Å)
            VALUES (%s, %s) RETURNING id_–∑–∞–∫—É–ø–∫–∏
        """,
            (random.choice(suppliers), random.choice(["–≤—ã–ø–æ–ª–Ω–µ–Ω–æ", "–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ"])),
        )
        z_id = cur.fetchone()[0]

        # –¢–æ–≤–∞—Ä—ã –≤ –∑–∞–∫—É–ø–∫–µ
        bought_mats = random.sample(material_ids, k=random.randint(3, 8))
        for m_id in bought_mats:
            cur.execute(
                "SELECT —Ü–µ–Ω–∞_–∑–∞_–µ–¥–∏–Ω–∏—Ü—É FROM –º–∞—Ç–µ—Ä–∏–∞–ª—ã WHERE id_–º–∞—Ç–µ—Ä–∏–∞–ª–∞ = %s", (m_id,)
            )
            base_price = cur.fetchone()[0]

            cur.execute(
                """
                INSERT INTO —Å–æ—Å—Ç–∞–≤_–∑–∞–∫—É–ø–∫–∏ (id_–∑–∞–∫—É–ø–∫–∏, id_–º–∞—Ç–µ—Ä–∏–∞–ª–∞, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Ü–µ–Ω–∞_–∑–∞–∫—É–ø–∫–∏)
                VALUES (%s, %s, %s, %s)
            """,
                (
                    z_id,
                    m_id,
                    random.randint(10, 100),
                    float(base_price) * 0.9,  # –ü–æ–∫—É–ø–∞–µ–º —á—É—Ç—å –¥–µ—à–µ–≤–ª–µ —Ä–æ–∑–Ω–∏—Ü—ã
                ),
            )

    conn.commit()
    cur.close()
    conn.close()
    print("‚úÖ –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏!")


if __name__ == "__main__":
    seed()
